FROM node:20-alpine

WORKDIR /app

# 依存だけ先に入れるとキャッシュが効きやすい
COPY package*.json ./
RUN npm ci

# アプリ本体
COPY . .

# Next のウォッチを安定させる
ENV CHOKIDAR_USEPOLLING=1 \
    NEXT_TELEMETRY_DISABLED=1

# ブラウザから API に当てるURL（JSに埋まる）
# ※ compose で上書きするのでダミーでもOK
ENV NEXT_PUBLIC_API_BASE=http://localhost:8000

EXPOSE 3000
CMD ["npm","run","dev","--","-p","3000","-H","0.0.0.0"]
